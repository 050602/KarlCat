{"version":3,"file":"Sigleton.js","sourceRoot":"","sources":["../../src/core/Sigleton.ts"],"names":[],"mappings":";;;AAAA,qCAAiC;AACjC,gCAA6B;AAE7B,MAAsB,QAAQ;IAI1B;IACA,CAAC;IAED,SAAS;IACF,YAAY;IACnB,CAAC;IAAA,CAAC;IAEF,SAAS;IACF,eAAe;IACtB,CAAC;IAAA,CAAC;IAEF,UAAU;IACH,WAAW;QACd,sBAAsB;QACtB,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;IAC1B,CAAC;IAAA,CAAC;IAEF,IAAW,OAAO;QACd,IAAA,gBAAM,EAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACtB,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IAGS,MAAM,CAAC,WAAW;QACxB,+EAA+E;QAC/E,qBAAqB;QACrB,IAAI,IAAI,GAAS,IAAK,CAAC,SAAS,CAAC;QACjC,mBAAmB;QACnB,IAAI,IAAI,EAAE;YACN,IAAI,OAAO,GAAG,SAAG,CAAC,WAAW,CAAC;YAC9B,IAAI,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC;YACxB,IAAI,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAChC,IAAI,OAAO;gBACP,OAAO,OAAO,CAAC;SACtB;QAED,IAAI,CAAO,IAAK,CAAC,SAAS,EAAE;YACxB,IAAI,IAAI,GAAS,IAAK,CAAC,IAAI,CAAC;YAC5B,IAAI,CAAC,GAAQ,IAAI,IAAI,EAAE,CAAC;YACxB,CAAC,CAAC,QAAQ,GAAG,IAAI,CAAC;YAClB,CAAC,CAAC,YAAY,EAAE,CAAC;YACjB,SAAG,CAAC,WAAW,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;YAEvB,IAAK,CAAC,SAAS,GAAG,CAAC,CAAC;SAC7B;QACD,qBAAqB;QACrB,+EAA+E;QAC/E,OAAa,IAAK,CAAC,SAAS,CAAC;IACjC,CAAC;;AApDL,4BAkEC;AAxCU,YAAG,GAAG,CAAC,CAAC","sourcesContent":["import { assert } from \"console\";\r\nimport { app } from \"../app\";\r\n\r\nexport abstract class Sigleton {\r\n    private _clsName: string;\r\n    private _instance: any;\r\n\r\n    constructor() {\r\n    }\r\n\r\n    //当实例初始化时\r\n    public initInstance() {\r\n    };\r\n\r\n    //当实例被销毁时\r\n    public destoryInstance() {\r\n    };\r\n\r\n    //当实例被热更新时\r\n    public onHotReload() {\r\n        // this._clsName = \"\";\r\n        this._instance = this;\r\n    };\r\n\r\n    public get clsName(): string {\r\n        assert(this._clsName);\r\n        return this._clsName;\r\n    }\r\n\r\n    static cnt = 0;\r\n    protected static getInstance<T extends {}>(this: new () => T): T {\r\n        // console.log(Date.now(), 'get instance 1.0', (<any>this).name, Sigleton.cnt);\r\n        // Sigleton.cnt += 1;\r\n        let inst = (<any>this)._instance;\r\n        // inst和getInst不一致？\r\n        if (inst) {\r\n            let instMap = app.InstanceMap;\r\n            let name = inst.clsName;\r\n            let getInst = instMap.get(name);\r\n            if (getInst)\r\n                return getInst;\r\n        }\r\n\r\n        if (!(<any>this)._instance) {\r\n            let name = (<any>this).name;\r\n            let t: any = new this();\r\n            t._clsName = name;\r\n            t.initInstance();\r\n            app.InstanceMap.set(name, t);\r\n\r\n            (<any>this)._instance = t;\r\n        }\r\n        // Sigleton.cnt -= 1;\r\n        // console.log(Date.now(), 'get instance 1.1', (<any>this).name, Sigleton.cnt);\r\n        return (<any>this)._instance;\r\n    }\r\n\r\n    // protected static getInstance(T: any) {\r\n    //     if (T.SigletonInsName == null || T.SigletonInsName.length == 0) {\r\n    //         throw (\"单例名称不能为空！！！类名/方法名:\" + T.name);\r\n    //     }\r\n    //     let ins = app.InstanceMap.get(T.SigletonInsName);\r\n    //     if (!ins) {\r\n    //         ins = new T();\r\n    //         app.InstanceMap.set(T.SigletonInsName, ins);\r\n    //         ins.initInstance();\r\n    //     }\r\n    //     return ins;\r\n    // }\r\n}"]}